<!-- Success Message -->
<% if (msg === 'created') { %>
  <div class="success-msg">
    <p><strong>Todo created:</strong> "<%= title || 'Untitled' %>"</p>
    <% if (description && description !== '(none)') { %>
      <p><strong>Description:</strong> <%= description %></p>
    <% } %>
    <% if (dueDate) { %>
      <p><strong>Due:</strong> 
        <%= new Date(dueDate).toLocaleDateString('en-GB', { timeZone: 'Asia/Hong_Kong', day: 'numeric', month: 'short', year: 'numeric' }) %>
        <% if (dueTime) { %> at <%= dueTime %> HKT<% } else { %> (No time)<% } %>
      </p>
    <% } else { %>
      <p>No due date set.</p>
    <% } %>
  </div>
<% } else if (msg === 'updated') { %>
  <div class="success-msg">
    <p><strong>Todo updated:</strong> "<%= title || 'Untitled' %>"</p>
    <% if (dueDate) { %>
      <p><strong>New due:</strong> 
        <%= new Date(dueDate).toLocaleDateString('en-GB', { timeZone: 'Asia/Hong_Kong', day: 'numeric', month: 'short', year: 'numeric' }) %>
        <% if (dueTime) { %> at <%= dueTime %> HKT<% } %>
      </p>
    <% } %>
  </div>
<% } else if (msg === 'deleted') { %>
  <div class="success-msg">
    <p>Todo deleted successfully.</p>
  </div>
<% } %>

<!-- Search Result Count -->
<p class="result-count">
  <strong><%= totalFound %> item(s) found</strong>
  <% if (search) { %> for "<%= search %>"<% } %>
</p>

<!-- Todo Item -->
<strong class="todo-title"><%= todo.title %></strong>
<% if (todo.description) { %>
  <br><small class="description">(<%= todo.description %>)</small>
<% } else { %>
  <br><small class="description">(No description)</small>
<% } %>

<% if (todo.dueDate) { %>
  <% 
    const due = new Date(todo.dueDate);
    const hktDate = due.toLocaleDateString('en-GB', { timeZone: 'Asia/Hong_Kong', day: 'numeric', month: 'short', year: 'numeric' });
    const hktTime = due.toLocaleTimeString('en-GB', { timeZone: 'Asia/Hong_Kong', hour: '2-digit', minute: '2-digit', hour12: true });
    const now = new Date();
    const diffMs = due - now;
    const diffDays = Math.floor(diffMs / (1000*60*60*24));
    const diffHours = Math.floor((diffMs % (1000*60*60*24)) / (1000*60*60));
    let countdown = '';
    if (diffMs < 0) countdown = 'Overdue';
    else if (diffDays > 0) countdown = `${diffDays} day${diffDays > 1 ? 's' : ''} left`;
    else if (diffHours > 0) countdown = `${diffHours} hour${diffHours > 1 ? 's' : ''} left`;
    else countdown = 'Due soon';
  %>
  <br><small class="due-date">
    Due: <%= hktDate %> at <%= hktTime %> HKT â€” <%= countdown %>
  </small>
<% } else { %>
  <br><small class="due-date">No due date</small>
<% } %>
